<%= CSV.generate do |csv|
  header_fields = []
  @contact_form.contact_form_fields.order("position asc").each do |field|
    header_fields << field.label
  end
  csv << header_fields
  @contact_form.responses.each do |resp|
    row_fields = []
    resp.response_fields.includes(:contact_form_field).order('contact_form_fields.position asc').each do |field|
      if field.value.blank?
        row_fields << ""
      elsif field.file?
        row_fields << field.read_attribute(:file)
      else
        row_fields << field.value
      end
    end
    csv << row_fields
  end
end %>